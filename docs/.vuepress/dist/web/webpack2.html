<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>webpack 和 vite | 哇</title><meta name="description" content="哇">
    <link rel="modulepreload" href="/assets/app.06867174.js"><link rel="modulepreload" href="/assets/webpack2.html.617864a7.js"><link rel="modulepreload" href="/assets/webpack2.html.c264079b.js"><link rel="prefetch" href="/assets/index.html.c5390e6a.js"><link rel="prefetch" href="/assets/springboot.html.12389ff2.js"><link rel="prefetch" href="/assets/http.html.947c2389.js"><link rel="prefetch" href="/assets/tcp_udp.html.36b264f4.js"><link rel="prefetch" href="/assets/apply.html.28e5775c.js"><link rel="prefetch" href="/assets/assign.html.2be7c456.js"><link rel="prefetch" href="/assets/bind.html.c475086f.js"><link rel="prefetch" href="/assets/class.html.d209faa3.js"><link rel="prefetch" href="/assets/equal.html.5348be39.js"><link rel="prefetch" href="/assets/event.html.808bc2b2.js"><link rel="prefetch" href="/assets/function.html.6ecdaa64.js"><link rel="prefetch" href="/assets/instanceof.html.570a569b.js"><link rel="prefetch" href="/assets/let_var.html.bc27ba03.js"><link rel="prefetch" href="/assets/module.html.0f7b2362.js"><link rel="prefetch" href="/assets/new.html.460266aa.js"><link rel="prefetch" href="/assets/promise1.html.f033c91e.js"><link rel="prefetch" href="/assets/promise2.html.23b8e119.js"><link rel="prefetch" href="/assets/scope.html.7972736c.js"><link rel="prefetch" href="/assets/this.html.cde05b96.js"><link rel="prefetch" href="/assets/cookie和session.html.7cbcdb4a.js"><link rel="prefetch" href="/assets/cors请求.html.ff488a0d.js"><link rel="prefetch" href="/assets/oauth2.0和jwt.html.f9dd3da6.js"><link rel="prefetch" href="/assets/xss与csrf.html.7baefeaf.js"><link rel="prefetch" href="/assets/sort.html.8a275f43.js"><link rel="prefetch" href="/assets/babel.html.16e96e69.js"><link rel="prefetch" href="/assets/react-hooks.html.d79be41b.js"><link rel="prefetch" href="/assets/url.html.6cc10f68.js"><link rel="prefetch" href="/assets/vue3.html.da645933.js"><link rel="prefetch" href="/assets/webassembly.html.72d02562.js"><link rel="prefetch" href="/assets/webpack1.html.70f93b14.js"><link rel="prefetch" href="/assets/base.html.e69da62f.js"><link rel="prefetch" href="/assets/gymnastics.html.87528ec2.js"><link rel="prefetch" href="/assets/polyfill.html.1411e9c3.js"><link rel="prefetch" href="/assets/tsconfig.html.a6c68a22.js"><link rel="prefetch" href="/assets/404.html.c3e557d0.js"><link rel="prefetch" href="/assets/index.html.2e6fd96c.js"><link rel="prefetch" href="/assets/springboot.html.edda17d4.js"><link rel="prefetch" href="/assets/http.html.41acf68f.js"><link rel="prefetch" href="/assets/tcp_udp.html.7eb9e453.js"><link rel="prefetch" href="/assets/apply.html.c10a7fc2.js"><link rel="prefetch" href="/assets/assign.html.716bbafa.js"><link rel="prefetch" href="/assets/bind.html.f0e32ec4.js"><link rel="prefetch" href="/assets/class.html.70017ca6.js"><link rel="prefetch" href="/assets/equal.html.9b94873c.js"><link rel="prefetch" href="/assets/event.html.def667f0.js"><link rel="prefetch" href="/assets/function.html.bc1abefd.js"><link rel="prefetch" href="/assets/instanceof.html.fe9cc1d4.js"><link rel="prefetch" href="/assets/let_var.html.e29d9e2c.js"><link rel="prefetch" href="/assets/module.html.7987826c.js"><link rel="prefetch" href="/assets/new.html.4a21747a.js"><link rel="prefetch" href="/assets/promise1.html.c35b42ce.js"><link rel="prefetch" href="/assets/promise2.html.05904378.js"><link rel="prefetch" href="/assets/scope.html.4ecfa06b.js"><link rel="prefetch" href="/assets/this.html.860730ac.js"><link rel="prefetch" href="/assets/cookie和session.html.49ee61a4.js"><link rel="prefetch" href="/assets/cors请求.html.f3dfc3b1.js"><link rel="prefetch" href="/assets/oauth2.0和jwt.html.7a12ef28.js"><link rel="prefetch" href="/assets/xss与csrf.html.72dbede6.js"><link rel="prefetch" href="/assets/sort.html.91aa3022.js"><link rel="prefetch" href="/assets/babel.html.eee818f0.js"><link rel="prefetch" href="/assets/react-hooks.html.6afe36e0.js"><link rel="prefetch" href="/assets/url.html.6c54dbf5.js"><link rel="prefetch" href="/assets/vue3.html.5b12f7b7.js"><link rel="prefetch" href="/assets/webassembly.html.19289d36.js"><link rel="prefetch" href="/assets/webpack1.html.765d3160.js"><link rel="prefetch" href="/assets/base.html.788c5c8d.js"><link rel="prefetch" href="/assets/gymnastics.html.73be6e51.js"><link rel="prefetch" href="/assets/polyfill.html.eaa013dd.js"><link rel="prefetch" href="/assets/tsconfig.html.e76f11fc.js"><link rel="prefetch" href="/assets/404.html.44e13ae3.js">
    <link rel="stylesheet" href="/assets/style.ae14e525.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">哇</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">javascript <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/js/this.html" class="sidebar-item" aria-label="this"><!--[--><!--]--> this <!--[--><!--]--></a><!----></li><li><a href="/js/class.html" class="sidebar-item" aria-label="类"><!--[--><!--]--> 类 <!--[--><!--]--></a><!----></li><li><a href="/js/event.html" class="sidebar-item" aria-label="事件循环机制/Event loop"><!--[--><!--]--> 事件循环机制/Event loop <!--[--><!--]--></a><!----></li><li><a href="/js/function.html" class="sidebar-item" aria-label="函数"><!--[--><!--]--> 函数 <!--[--><!--]--></a><!----></li><li><a href="/js/module.html" class="sidebar-item" aria-label="CommonJS、AMD、CMD、ESM、UMD"><!--[--><!--]--> CommonJS、AMD、CMD、ESM、UMD <!--[--><!--]--></a><!----></li><li><a href="/js/promise1.html" class="sidebar-item" aria-label="Promise--上"><!--[--><!--]--> Promise--上 <!--[--><!--]--></a><!----></li><li><a href="/js/promise2.html" class="sidebar-item" aria-label="Promise--下"><!--[--><!--]--> Promise--下 <!--[--><!--]--></a><!----></li><li><a href="/js/scope.html" class="sidebar-item" aria-label="作用域"><!--[--><!--]--> 作用域 <!--[--><!--]--></a><!----></li><li><a href="/js/new.html" class="sidebar-item" aria-label="new"><!--[--><!--]--> new <!--[--><!--]--></a><!----></li><li><a href="/js/let,var.html" class="sidebar-item" aria-label="let和var"><!--[--><!--]--> let和var <!--[--><!--]--></a><!----></li><li><a href="/js/bind.html" class="sidebar-item" aria-label="bind"><!--[--><!--]--> bind <!--[--><!--]--></a><!----></li><li><a href="/js/apply.html" class="sidebar-item" aria-label="call、apply"><!--[--><!--]--> call、apply <!--[--><!--]--></a><!----></li><li><a href="/js/equal.html" class="sidebar-item" aria-label="隐式转换 == 和 ==="><!--[--><!--]--> 隐式转换 == 和 === <!--[--><!--]--></a><!----></li><li><a href="/js/assign.html" class="sidebar-item" aria-label="Object.assign和...（展开运算符/扩展运算符）的区别 [已发帖]"><!--[--><!--]--> Object.assign和...（展开运算符/扩展运算符）的区别 [已发帖] <!--[--><!--]--></a><!----></li><li><a href="/js/instanceof.html" class="sidebar-item" aria-label="instanceof [已发帖]"><!--[--><!--]--> instanceof [已发帖] <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">typescript <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/typescript/tsconfig.html" class="sidebar-item" aria-label="tsconfig.json配置"><!--[--><!--]--> tsconfig.json配置 <!--[--><!--]--></a><!----></li><li><a href="/typescript/base.html" class="sidebar-item" aria-label="typescript基础"><!--[--><!--]--> typescript基础 <!--[--><!--]--></a><!----></li><li><a href="/typescript/polyfill.html" class="sidebar-item" aria-label="工具类的模拟实现"><!--[--><!--]--> 工具类的模拟实现 <!--[--><!--]--></a><!----></li><li><a href="/typescript/gymnastics.html" class="sidebar-item" aria-label="ts类型体操训练"><!--[--><!--]--> ts类型体操训练 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">前端相关 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/web/webpack1.html" class="sidebar-item" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/web/webpack2.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="webpack 和 vite"><!--[--><!--]--> webpack 和 vite <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/web/webpack2.html#webpack和vite两者有什么区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack和vite两者有什么区别"><!--[--><!--]--> webpack和vite两者有什么区别 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/web/webpack2.html#vite和webpack5的缓存" class="router-link-active router-link-exact-active sidebar-item" aria-label="vite和webpack5的缓存"><!--[--><!--]--> vite和webpack5的缓存 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/web/webpack2.html#vite缓存" class="router-link-active router-link-exact-active sidebar-item" aria-label="vite缓存"><!--[--><!--]--> vite缓存 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/web/webpack2.html#webpack缓存" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack缓存"><!--[--><!--]--> webpack缓存 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/web/webpack2.html#vite为啥比webpack快" class="router-link-active router-link-exact-active sidebar-item" aria-label="vite为啥比webpack快？"><!--[--><!--]--> vite为啥比webpack快？ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/web/webpack2.html#vite开发时快在哪" class="router-link-active router-link-exact-active sidebar-item" aria-label="vite开发时快在哪？"><!--[--><!--]--> vite开发时快在哪？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/web/webpack2.html#webpack开发时慢在哪" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack开发时慢在哪？"><!--[--><!--]--> webpack开发时慢在哪？ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/web/webpack2.html#hmr-热更新原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="HMR 热更新原理"><!--[--><!--]--> HMR 热更新原理 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/web/webpack2.html#webpack热更新" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack热更新"><!--[--><!--]--> webpack热更新 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/web/webpack2.html#vite-热更新" class="router-link-active router-link-exact-active sidebar-item" aria-label="vite 热更新"><!--[--><!--]--> vite 热更新 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/web/webpack2.html#参考" class="router-link-active router-link-exact-active sidebar-item" aria-label="参考"><!--[--><!--]--> 参考 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/web/url.html" class="sidebar-item" aria-label="浏览器从输入url发生了什么[未完...]"><!--[--><!--]--> 浏览器从输入url发生了什么[未完...] <!--[--><!--]--></a><!----></li><li><a href="/web/babel.html" class="sidebar-item" aria-label="babel"><!--[--><!--]--> babel <!--[--><!--]--></a><!----></li><li><a href="/web/webassembly.html" class="sidebar-item" aria-label="快速入门WebAssembly/wasm"><!--[--><!--]--> 快速入门WebAssembly/wasm <!--[--><!--]--></a><!----></li><li><a href="/web/vue3.html" class="sidebar-item" aria-label="vue3源码[未完...]"><!--[--><!--]--> vue3源码[未完...] <!--[--><!--]--></a><!----></li><li><a href="/web/react-hooks.html" class="sidebar-item" aria-label="React Hooks源码"><!--[--><!--]--> React Hooks源码 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">web安全相关 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/security/xss%E4%B8%8Ecsrf.html" class="sidebar-item" aria-label="XSS和CSRF"><!--[--><!--]--> XSS和CSRF <!--[--><!--]--></a><!----></li><li><a href="/security/cors%E8%AF%B7%E6%B1%82.html" class="sidebar-item" aria-label="跨域请求"><!--[--><!--]--> 跨域请求 <!--[--><!--]--></a><!----></li><li><a href="/security/cookie%E5%92%8Csession.html" class="sidebar-item" aria-label="cookie 和 session"><!--[--><!--]--> cookie 和 session <!--[--><!--]--></a><!----></li><li><a href="/security/oauth2.0%E5%92%8Cjwt.html" class="sidebar-item" aria-label="OAuth2.0和JWT"><!--[--><!--]--> OAuth2.0和JWT <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">计算机网络相关 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/network/http.html" class="sidebar-item" aria-label="http"><!--[--><!--]--> http <!--[--><!--]--></a><!----></li><li><a href="/network/tcp,udp.html" class="sidebar-item" aria-label="TCP/UDP"><!--[--><!--]--> TCP/UDP <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">数据结构与算法 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/structure/sort.html" class="sidebar-item" aria-label="排序"><!--[--><!--]--> 排序 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">java <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/java/springboot.html" class="sidebar-item" aria-label="springboot"><!--[--><!--]--> springboot <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="webpack-和-vite" tabindex="-1"><a class="header-anchor" href="#webpack-和-vite" aria-hidden="true">#</a> webpack 和 vite</h1><h2 id="webpack和vite两者有什么区别" tabindex="-1"><a class="header-anchor" href="#webpack和vite两者有什么区别" aria-hidden="true">#</a> webpack和vite两者有什么区别</h2><p>webpack core 是一个纯打包工具（对标 Rollup），而 Vite 其实是一个更上层的工具链方案，对标的是 （webpack + 针对 web 的常用配置 + webpack-dev-server）。</p><p>意思两者不是同样的东西。vite被分为cli部分和api的部分，api的部分才和webpack相似。</p><h2 id="vite和webpack5的缓存" tabindex="-1"><a class="header-anchor" href="#vite和webpack5的缓存" aria-hidden="true">#</a> vite和webpack5的缓存</h2><h3 id="vite缓存" tabindex="-1"><a class="header-anchor" href="#vite缓存" aria-hidden="true">#</a> vite缓存</h3><ol><li>浏览器缓存 解析后的依赖请求会以 HTTP 头 max-age=31536000,immutable 强缓存，以提高在开发时的页面重载性能。一旦被缓存，这些请求将永远不会再到达开发服务器。</li><li>文件系统缓存 Vite会将预构建的依赖缓存到node_modules/.vite。它根据几个源来决定是否需要重新运行预构建步骤：</li></ol><ul><li>package.json中的dependencies列表。</li><li>包管理器的 lockfile，例如 package-lock.json, yarn.lock，或者 pnpm-lock.yaml。</li><li>可能在 vite.config.js 相关字段中配置过的。</li></ul><p>只有在上述其中一项发生更改时，才需要重新运行预构建。</p><p>如果出于某些原因，你想要强制 Vite 重新构建依赖，你可以用 --force 命令行选项启动开发服务器，或者手动删除 node_modules/.vite 目录。</p><h3 id="webpack缓存" tabindex="-1"><a class="header-anchor" href="#webpack缓存" aria-hidden="true">#</a> webpack缓存</h3><p>在4.x版本中需要使用cache-loader来对打包结果进行缓存。在5.x版本中，无需再次安装cache-loader，如果没有做任何配置，默认就开启了打包缓存，不过是缓存到内存(memory)中，内存的空间多么宝贵啊，有些时候内存可能还不够用，我们就可以对cache配置，将缓存结果缓存到硬盘(filesystem)中。同时也可以指定缓存文件被保存的位置。 配置webpack.config.js的cache.type 设置为 &#39;filesystem&#39;时，编译的缓存默认在 node_modules/.cache/webpack里</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;filesystem&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">allowCollectingMemory</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">buildDependencies</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">config</span><span class="token operator">:</span> <span class="token punctuation">[</span>__filename<span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 当构建依赖的config文件（通过 require 依赖）内容发生变化时，缓存失效</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">compression</span><span class="token operator">:</span> <span class="token string">&#39;gzip&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 配置项仅在 cache.type 设为 &#39;filesystem&#39; 时可用。用于缓存文件的压缩类型。development 模式下默认为 false，production 模式下默认为 &#39;gzip&#39;。</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="vite为啥比webpack快" tabindex="-1"><a class="header-anchor" href="#vite为啥比webpack快" aria-hidden="true">#</a> vite为啥比webpack快？</h2><p>vite的打包用的是<code>rollup</code>，开发的时候用的<code>esbuild</code>。所以我们说快，指的一般是开发的体验。</p><h3 id="vite开发时快在哪" tabindex="-1"><a class="header-anchor" href="#vite开发时快在哪" aria-hidden="true">#</a> vite开发时快在哪？</h3><p>Vite 通过在一开始将应用中的模块区分为 <code>依赖</code> 和 <code>源码</code> 两类，改进了开发服务器启动时间</p><ol><li><code>依赖</code></li></ol><ul><li>大多为在开发时不会变动的纯 JavaScript。一些较大的依赖（例如有上百个模块的组件库）处理的代价也很高。依赖也通常会存在多种模块化格式（例如 ESM 或者 CommonJS）。</li><li>Vite 将会使用 <code>esbuild</code> 预构建依赖。esbuild 使用 Go 编写，并且比以 JavaScript 编写的打包器预构建依赖快 10-100 倍。</li></ul><ol start="2"><li><code>源码</code></li></ol><ul><li>通常包含一些并非直接是 JavaScript 的文件，需要转换（例如 JSX，CSS 或者 Vue/Svelte 组件），时常会被编辑。同时，并不是所有的源码都需要同时被加载（例如基于路由拆分的代码模块）。</li><li>Vite 以 原生 ESM 方式提供源码。这实际上是让浏览器接管了打包程序的部分工作：Vite 只需要在浏览器请求源码时进行转换并按需提供源码。根据情景动态导入代码，即只在当前屏幕上实际使用时才会被处理。</li></ul><p>在 Vite 中，HMR 是在原生 ESM 上执行的。当编辑一个文件时，Vite 只需要精确地使已编辑的模块与其最近的 HMR 边界之间的链失活（大多数时候只是模块本身），使得无论应用大小如何，HMR 始终能保持快速更新。</p><p>vite 同时利用 HTTP 头来进行缓存</p><ul><li>源码模块使用<code>304 Not Modified</code>进行协商缓存</li><li>依赖模块请求会通过 Cache-Control: max-age=31536000,immutable 进行强缓存，因此一旦被缓存它们将不需要再次请求</li></ul><h3 id="webpack开发时慢在哪" tabindex="-1"><a class="header-anchor" href="#webpack开发时慢在哪" aria-hidden="true">#</a> webpack开发时慢在哪？</h3><p>webpack 的本质就是先打包，再加载。webpack-dev-server 只是一个在内存里用 webpack 打包的服务器而已。webpack 的一个软肋是 loader / 插件机制跟打包的这个设计前提耦合过深。如果想走no-bundle 路线就不再是webpack了。</p><p>所以即使webpack用esbuild也不能和vite一样块。因为还有loader、plugin等复杂的东西。 如果是打包速度的话，两者就变成了webpack和rollup打包谁快的问题了。</p><h2 id="hmr-热更新原理" tabindex="-1"><a class="header-anchor" href="#hmr-热更新原理" aria-hidden="true">#</a> HMR 热更新原理</h2><h3 id="webpack热更新" tabindex="-1"><a class="header-anchor" href="#webpack热更新" aria-hidden="true">#</a> webpack热更新</h3><ol><li>webpack-dev-middleware 是一个容器(wrapper), 它可以把 webpack 处理后的文件传递给一个服务器(server). webpack-dev-server 在内部使用了它。</li><li>浏览器加载页面后，与 webpack-dev-server 建立 WebSocket 连接</li><li>Webpack 监听到文件变化后，增量构建发生变更的模块，并通过 WebSocket 发送 hash 事件</li><li>浏览器接收到 hash 事件后，请求 manifest 资源文件，确认增量变更范围</li><li>浏览器加载发生变更的增量模块</li><li>Webpack 运行时触发变更模块的 module.hot.accept 回调，执行代码变更逻辑</li></ol><p>webpack启用 Watch 模式。这意味着在初始构建之后，webpack 将继续监听任何已解析文件的更改</p><blockquote><p>webpack-dev-server 和 webpack-dev-middleware 里 Watch 模式默认开启。 webpack.config.js</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>webpack-dev-middleware和webpack-dev-server的文件监听功能就是用的chokidar库，和vite用的一样。具体可以在它的依赖里看见。</p><ul><li><a href="https://github.com/webpack/webpack-dev-middleware/blob/master/package.json?#L68" target="_blank" rel="noopener noreferrer">webpack-dev-middleware package.json<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/webpack/webpack-dev-server/blob/master/package.json?#56" target="_blank" rel="noopener noreferrer">webpack-dev-server package.json<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h3 id="vite-热更新" tabindex="-1"><a class="header-anchor" href="#vite-热更新" aria-hidden="true">#</a> vite 热更新</h3><ol><li>服务器启动时创建 WebSocket 实例、通过 <a href="https://www.npmjs.com/package/chokidar" target="_blank" rel="noopener noreferrer">chokidar(是封装 Node.js 监控文件系统文件变化功能的库，它解决了原生fs.watch、fs.watchFile的问题)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 监听文件修改</li><li>对请求的 HTML 文件注入客户端热更新代码</li><li>加载客户端热更新代码时，创建 WebSocket 实例，并注册监听</li><li>当被请求文件中有i<wbr>mport.meta.hot.accept时，向该文件注入i<wbr>mport.meta.hot.accept定义</li><li>当文件更新时，触发文件修改的回调。</li><li>如果是配置文件、自定义插件、.env文件修改直接重启服务器</li><li>反之，根据模块路径向上查找；收集接受当前依赖项更新的模块，并判断是否是刷新页面</li><li>如果是刷新页面，向客户端发送刷新页面的消息，反之发送更新消息，并将接受当前依赖项更新的模块一起发送给客户端</li><li>客户端接收到之后，获取要更新的模块路径和热更新回调，通过import()请求要更新模块的路径，并在 URL 挂上import和时间戳；并在下一任务队列中触发热更新回调。</li></ol><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h2><ul><li><p><a href="https://webpack.docschina.org/configuration/cache/" target="_blank" rel="noopener noreferrer">webpack 官网 Cache部分<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p><a href="https://cn.vitejs.dev/guide/dep-pre-bundling.html#caching" target="_blank" rel="noopener noreferrer">vite 官网 依赖预构建<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/363928061" target="_blank" rel="noopener noreferrer">吃透 Webpack 核心原理<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p><a href="http://webpack.wuhaolin.cn/" target="_blank" rel="noopener noreferrer">《深入浅出webpack》在线书籍<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/30669007" target="_blank" rel="noopener noreferrer">Webpack HMR 原理解析<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/410510492" target="_blank" rel="noopener noreferrer">HMR 原理全解析<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p><a href="http://www.icodebang.com/article/283616" target="_blank" rel="noopener noreferrer">vite 热更新原理<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p><a href="https://www.npmjs.com/package/chokidar" target="_blank" rel="noopener noreferrer">chokidar(是封装 Node.js 监控文件系统文件变化功能的库，它解决了原生fs.watch、fs.watchFile的问题)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p><a href="https://www.zhihu.com/question/477139054/answer/2156019180" target="_blank" rel="noopener noreferrer">vite多久后能干掉webpack？ - 尤雨溪的回答 - 知乎<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p><a href="https://www.bilibili.com/video/BV1Rr4y1L7r3?share_source=copy_web&amp;vd_source=9283e7aefc23b98d417bbc93b42bcf05&amp;t=1412" target="_blank" rel="noopener noreferrer">【尤雨溪前端趋势2022 的主题演讲】【精准空降到 23:32】<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/web/webpack1.html" class="" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a></span><span class="next"><a href="/web/url.html" class="" aria-label="浏览器从输入url发生了什么[未完...]"><!--[--><!--]--> 浏览器从输入url发生了什么[未完...] <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.06867174.js" defer></script>
  </body>
</html>
